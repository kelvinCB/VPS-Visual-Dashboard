<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Kelvin VPS Dashboard - Monitor your server metrics in real-time">
  <meta name="theme-color" content="#2563EB">
  <title>Kelvin VPS Dashboard</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="/icons/icon.svg" type="image/svg+xml">
  <script>
    document.documentElement.classList.add('js');
  </script>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="dashboard">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <img class="logo-icon" src="/icons/icon.svg" alt="Kelvin VPS" width="40" height="40" />
          <span class="logo-text">Kelvin VPS</span>
        </div>
      </div>
      <div class="header-right">
        <button class="theme-toggle" id="theme-toggle" type="button" aria-label="Switch to light mode"
          title="Toggle theme">
          <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
          <span class="theme-label" id="theme-label">Dark</span>
        </button>
        <div class="status-badge" id="status-badge">
          <span class="status-dot"></span>
          <span>Running</span>
        </div>
        <button class="refresh-btn" id="refresh-btn" title="Refresh metrics">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6" />
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
          </svg>
        </button>
      </div>
    </header>

    <!-- System Info Bar -->
    <section class="system-info-bar">
      <div class="system-info-item">
        <span class="system-label">OS</span>
        <span class="system-value" id="os-info">Loading...</span>
      </div>
      <div class="system-info-item">
        <span class="system-label">Hostname</span>
        <span class="system-value" id="hostname">Loading...</span>
      </div>
      <div class="system-info-item">
        <span class="system-label">Uptime</span>
        <span class="system-value" id="uptime">Loading...</span>
      </div>
      <div class="system-info-item">
        <span class="system-label">Location</span>
        <span class="system-value" id="location">Loading...</span>
      </div>
    </section>

    <!-- Main Metrics Grid -->
    <main class="metrics-grid">
      <!-- CPU Usage Card (Clickable) -->
      <article class="metric-card clickable" id="cpu-card" title="Click for details" role="button" tabindex="0" aria-label="Open CPU details">
        <div class="metric-header">
          <span class="metric-title">CPU usage</span>
          <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <rect x="9" y="9" width="6" height="6" />
            <line x1="9" y1="1" x2="9" y2="4" />
            <line x1="15" y1="1" x2="15" y2="4" />
            <line x1="9" y1="20" x2="9" y2="23" />
            <line x1="15" y1="20" x2="15" y2="23" />
            <line x1="20" y1="9" x2="23" y2="9" />
            <line x1="20" y1="14" x2="23" y2="14" />
            <line x1="1" y1="9" x2="4" y2="9" />
            <line x1="1" y1="14" x2="4" y2="14" />
          </svg>
        </div>
        <div class="metric-value">
          <span id="cpu-value">0</span><span class="metric-unit">%</span>
        </div>
        <div class="metric-chart">
          <canvas id="cpu-chart" width="280" height="60"></canvas>
        </div>
        <span class="click-hint">Click for details</span>
      </article>

      <!-- Memory Usage Card (Clickable) -->
      <article class="metric-card clickable" id="memory-card" title="Click for details">
        <div class="metric-header">
          <span class="metric-title">Memory usage</span>
          <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="6" width="20" height="12" rx="2" />
            <path d="M6 6V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2" />
            <line x1="6" y1="10" x2="6" y2="14" />
            <line x1="10" y1="10" x2="10" y2="14" />
            <line x1="14" y1="10" x2="14" y2="14" />
            <line x1="18" y1="10" x2="18" y2="14" />
          </svg>
        </div>
        <div class="metric-value">
          <span id="memory-value">0</span><span class="metric-unit">%</span>
        </div>
        <div class="metric-chart">
          <canvas id="memory-chart" width="280" height="60"></canvas>
        </div>
        <div class="metric-detail">
          <span id="memory-detail">0 GB / 0 GB</span>
        </div>
        <span class="click-hint">Click for details</span>
      </article>

      <!-- Disk Usage Card (Clickable) -->
      <article class="metric-card disk-card clickable" id="disk-card" title="Click for details" role="button" tabindex="0" aria-label="Open disk details">
        <div class="metric-header">
          <span class="metric-title">Disk usage</span>
          <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <ellipse cx="12" cy="5" rx="9" ry="3" />
            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" />
            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" />
          </svg>
        </div>
        <div class="disk-content">
          <div class="disk-chart-container">
            <canvas id="disk-chart" width="100" height="100"></canvas>
            <div class="disk-percentage">
              <span id="disk-value">0</span><span class="metric-unit">%</span>
            </div>
          </div>
          <div class="disk-info">
            <span id="disk-detail">0 GB / 0 GB</span>
          </div>
        </div>
        <span class="click-hint">Click for details</span>
      </article>

      <!-- Incoming Traffic Card -->
      <article class="metric-card" id="traffic-in-card">
        <div class="metric-header">
          <span class="metric-title">Incoming traffic</span>
          <svg class="metric-icon incoming" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M5 12l7-7 7 7" />
          </svg>
        </div>
        <div class="metric-value">
          <span id="traffic-in-value">0</span><span class="metric-unit" id="traffic-in-unit">MB</span>
        </div>
        <div class="metric-chart">
          <canvas id="traffic-in-chart" width="280" height="60"></canvas>
        </div>
      </article>

      <!-- Outgoing Traffic Card -->
      <article class="metric-card" id="traffic-out-card">
        <div class="metric-header">
          <span class="metric-title">Outgoing traffic</span>
          <svg class="metric-icon outgoing" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M19 12l-7 7-7-7" />
          </svg>
        </div>
        <div class="metric-value">
          <span id="traffic-out-value">0</span><span class="metric-unit" id="traffic-out-unit">MB</span>
        </div>
        <div class="metric-chart">
          <canvas id="traffic-out-chart" width="280" height="60"></canvas>
        </div>
      </article>

      <!-- Bandwidth Card -->
      <article class="metric-card bandwidth-card clickable" id="bandwidth-card"
        title="Click to set monthly bandwidth limit">
        <div class="metric-header">
          <span class="metric-title">Monthly Bandwidth</span>
          <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
          </svg>
        </div>
        <div class="bandwidth-content">
          <div class="bandwidth-chart-container">
            <canvas id="bandwidth-chart" width="100" height="100"></canvas>
            <div class="bandwidth-value-overlay">
              <span id="bandwidth-value">0</span>
              <span class="bandwidth-unit" id="bandwidth-unit">GB</span>
            </div>
          </div>
          <div class="metric-detail">
            <span id="bandwidth-detail">Month-to-date</span>
          </div>
          <span class="click-hint" id="bandwidth-hint">Click to set monthly limit</span>
        </div>
      </article>
    </main>

    <!-- VPS Details Section -->
    <section class="details-section">
      <div class="details-card">
        <h3 class="details-title">VPS Details</h3>
        <div class="details-grid">
          <div class="detail-item">
            <span class="detail-label">Kernel</span>
            <span class="detail-value" id="kernel-info">Loading...</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Architecture</span>
            <span class="detail-value" id="arch-info">Loading...</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">CPU Cores</span>
            <span class="detail-value" id="cores-info">Loading...</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <span>Last updated: <span id="last-updated">Never</span></span>
      <span>Refresh interval: 25s</span>
    </footer>
  </div>

  <!-- Memory Details Modal -->
  <div class="modal-overlay" id="memory-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Memory Details</h2>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="memory-breakdown">
          <h3>Memory Breakdown</h3>
          <div class="breakdown-grid" id="breakdown-grid">
            <div class="breakdown-item">
              <span class="breakdown-label">Total</span>
              <span class="breakdown-value" id="mem-total">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Used</span>
              <span class="breakdown-value" id="mem-used">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Free</span>
              <span class="breakdown-value" id="mem-free">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Available</span>
              <span class="breakdown-value" id="mem-available">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Buffers</span>
              <span class="breakdown-value" id="mem-buffers">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Cached</span>
              <span class="breakdown-value" id="mem-cached">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Swap Used</span>
              <span class="breakdown-value" id="mem-swap">-</span>
            </div>
          </div>
        </div>
        <div class="processes-section">
          <h3>Top Processes by Memory</h3>
          <div class="processes-table-container">
            <table class="processes-table">
              <thead>
                <tr>
                  <th>Process</th>
                  <th>PID</th>
                  <th>Memory</th>
                  <th>%</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="processes-tbody">
                <tr>
                  <td colspan="4">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CPU Details Modal -->
  <div class="modal-overlay" id="cpu-modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cpu-modal-title">
      <div class="modal-header">
        <h2 class="modal-title" id="cpu-modal-title">CPU Details</h2>
        <button class="modal-close" id="cpu-modal-close" type="button" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="cpu-breakdown">
          <h3>CPU Breakdown</h3>
          <div class="breakdown-grid">
            <div class="breakdown-item">
              <span class="breakdown-label">Overall</span>
              <span class="breakdown-value" id="cpu-overall">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Cores</span>
              <span class="breakdown-value" id="cpu-cores">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Load (1m)</span>
              <span class="breakdown-value" id="cpu-load-1m">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Load (5m)</span>
              <span class="breakdown-value" id="cpu-load-5m">-</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Load (15m)</span>
              <span class="breakdown-value" id="cpu-load-15m">-</span>
            </div>
          </div>
        </div>

        <div class="cpu-history">
          <h3>Recent CPU Usage</h3>
          <div class="metric-chart" style="margin-top: 0.5rem;">
            <canvas id="cpu-modal-chart" width="560" height="90"></canvas>
          </div>
        </div>

        <div class="processes-section">
          <h3>Top Processes by CPU</h3>
          <div class="processes-table-container">
            <table class="processes-table">
              <thead>
                <tr>
                  <th>Process</th>
                  <th>PID</th>
                  <th>CPU %</th>
                  <th>Mem %</th>
                </tr>
              </thead>
              <tbody id="cpu-processes-tbody">
                <tr>
                  <td colspan="4">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Disk Details Modal -->
  <div class="modal-overlay" id="disk-modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="disk-modal-title">
      <div class="modal-header">
        <h2 class="modal-title" id="disk-modal-title">Disk Details</h2>
        <button class="modal-close" id="disk-modal-close" type="button" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="processes-section">
          <h3>Filesystems</h3>
          <div class="processes-table-container">
            <table class="processes-table">
              <thead>
                <tr>
                  <th>Mount</th>
                  <th>Size</th>
                  <th>Used</th>
                  <th>Avail</th>
                  <th>%</th>
                </tr>
              </thead>
              <tbody id="disk-filesystems-tbody">
                <tr>
                  <td colspan="5">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <p class="muted-note" id="disk-note" style="margin-top: 12px;">-</p>

          <hr style="margin: 16px 0; opacity: 0.15;" />

          <div>
            <div style="display:flex; align-items:center; justify-content:space-between; gap: 12px; flex-wrap: wrap;">
              <h3 style="margin: 0;">Top directories (shallow scan)</h3>
              <button id="disk-breakdown-btn" type="button" class="btn btn-primary" style="padding: 8px 12px;">
                Scan /
              </button>
            </div>
            <p class="muted-note" id="disk-breakdown-note" style="margin-top: 8px;">
              This is a shallow, same-filesystem scan to explain used space. Results are cached briefly.
            </p>
            <div id="disk-breakdown-status" class="muted-note" style="margin-top: 8px;"></div>
            <ul id="disk-breakdown-list" style="margin-top: 8px; padding-left: 18px;"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Optional runtime configuration.
    // - API_TOKEN can be injected at deploy-time (e.g. templating, reverse-proxy substitution)
    // - Or set in browser localStorage as `apiToken`.
    window.CONFIG = window.CONFIG || {};
    // window.CONFIG.API_TOKEN = '...'; // DO NOT commit secrets.
  </script>
  <script src="app.js" defer></script>


  <!-- App Modal (custom alerts/confirmations) -->
  <div class="modal-overlay" id="app-modal" aria-hidden="true">
    <div class="modal app-modal" role="dialog" aria-modal="true" aria-labelledby="app-modal-title">
      <div class="modal-header app-modal-header">
        <h2 class="modal-title" id="app-modal-title">Notice</h2>
        <button class="modal-close" id="app-modal-close" type="button" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <p class="app-modal-message" id="app-modal-message"></p>
        <div class="app-modal-actions">
          <button class="btn-secondary" id="app-modal-cancel" type="button">Cancel</button>
          <button class="btn-primary" id="app-modal-confirm" type="button">OK</button>
        </div>
      </div>
    </div>
  </div>

</body>

</html>